<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Search Books</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- 가져온 template의 css-->
  <link th:href="@{/css/styles.css}" rel="stylesheet" />
  <!--sidebar + chatbot + 동작 시키는 js-->
  <script th:src="@{/js/sidebar.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/sketchy/bootstrap.min.css">
  <link th:href="@{/css/chatbot/floatingactionbutton.css}" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/chatbot/chatGPT.css}">
    <script>
        function likeBook(button) {
            var bookCard = $(button).closest('.card');
            var book = {
                title: bookCard.data('title'),
                author: bookCard.data('author'),
                publisher: bookCard.data('publisher'),
                image: bookCard.data('image'),
                description: bookCard.data('description'),
                link: bookCard.data('link'),
                pubdate: bookCard.data('pubdate'),
                discount: bookCard.data('discount'),
                isbn: bookCard.data('isbn')
            };
            $.ajax({
                url: "/user/booklikes",
                type: "POST",
                data: book,
                success: function (response) {
                    console.log('success');
                }
            });
            $(button).addClass('d-none');
            $(button).siblings('.btn-unlike').removeClass('d-none');

        }


        function unlikeBook(button) {
            var bookCard = $(button).closest('.card');
            var book = {
                title: bookCard.data('title'),
                author: bookCard.data('author'),
                publisher: bookCard.data('publisher'),
                image: bookCard.data('image'),
                description: bookCard.data('description'),
                link: bookCard.data('link'),
                pubdate: bookCard.data('pubdate'),
                discount: bookCard.data('discount'),
                isbn: bookCard.data('isbn')
            };
            $.ajax({
                url: "/user/bookunlikes",
                type: "POST",
                data: book,
                success: function (response) {
                    console.log('success');
                }
            });

            $(button).addClass('d-none');
            $(button).siblings('.btn-like').removeClass('d-none');

        }
        function FindBooks() {

            var searchQuery = $('#eventSearch').val();
            console.log(searchQuery);
            $.ajax({
                url: "/naver/books",
                type: "GET",
                data: {
                    keyword: searchQuery.trim()
                },
                success: function (response) {

                    if (response && response.length > 0) {
                        var booksInfo = $('#booksinfo');

                        response.forEach(function (book) {

                            var bookDiv = `
                        <div class="card mb-3" data-isbn="${book.isbn}" data-title="${book.title}" data-author="${book.author}" data-publisher="${book.publisher}" data-image="${book.image}" data-description="${book.description}" data-link="${book.link}" data-pubdate="${book.pubdate}" data-discount="${book.discount}">
                            <h3 class="card-header">${book.title}</h3>
                            <div class="card-body">
                                <h5 class="card-title">${book.author}</h5>
                                <h6 class="card-subtitle text-muted">${book.publisher}</h6>
                            </div>
                            <img src="${book.image}" alt="no image">
                            <div class="card-body">
                                <p class="card-text">${book.description}</p>
                            </div>
                            <div class="card-body">
                                <a href="${book.link}" class="card-link text-success" target="_blank">To Naver Shopping Link</a>
                            </div>
                            <div class="card-footer text-muted">
                                PUBLISHED DATE : ${book.pubdate}
                                <p class="float-end">PRICE : ₩${book.discount}</p>
                                <div class="btn-group mt-3" role="group">
                            <button onclick="likeBook(this)" class="btn btn-outline-primary btn-like">좋아요</button>
                            <button onclick="unlikeBook(this)" class="btn btn-outline-danger btn-unlike d-none">좋아요 취소</button>
                                </div>
                            </div>
                        </div>
                        `;


                            booksInfo.append(bookDiv);
                        });
                    } else {

                        $('#booksinfo').html('No books found.');
                    }
                },
                error: function (xhr, status, error) {

                    console.error(status + ": " + error);
                }
            });
        }
    </script>
</head>
<body class="sb-nav-fixed">
<th:block th:insert="~{common/menubar::menubar}"></th:block>

<div id="layoutSidenav">
    <th:block th:insert="~{common/sidebar::sidebar}"></th:block>
    <!--오른쪽 메뉴바가 아닌 부분에 대한 내용-->
    <div id="layoutSidenav_content">
        <h1 class="text-center">Search Books You Want!!</h1>
        <br>
        <input type="text" id="eventSearch">
        <button onclick="FindBooks()">검색</button>
        <br>
        <div id="booksinfo" class="row row-cols-1 row-cols-md-2 w-100 m-lg-5 d-flex justify-content-center">

        </div>

        <th:block th:insert="~{common/chatbot::chatbot}"></th:block>
        <th:block th:insert="~{common/footer::footer}"></th:block>
    </div>
</div>

</body>
</html>